<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oksana Protsukha">
<meta name="dcterms.date" content="2024-03-15">
<meta name="description" content="Infographic that addresses equity within EV charging network distribution in the United States">

<title>Oksana Protsukha - Is EV Charging Infrastructure Equitable?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="../../site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="../../site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="../../site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="../../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Oksana Protsukha</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Is EV Charging Infrastructure Equitable?</h1>
                  <div>
        <div class="description">
          Infographic that addresses equity within EV charging network distribution in the United States
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">DataViz</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Energy</div>
                <div class="quarto-category">EV</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://oksanaprotsukha.github.io/portfolio/">Oksana Protsukha</a> </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://ucsb-meds.github.io">
              Master of Environmental Data Science Program
              </a>
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 15, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a>
  <ul class="collapse">
  <li><a href="#final-infographic" id="toc-final-infographic" class="nav-link" data-scroll-target="#final-infographic">Final Infographic</a></li>
  </ul></li>
  <li><a href="#data-and-design-process" id="toc-data-and-design-process" class="nav-link" data-scroll-target="#data-and-design-process">Data And Design process</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#design-decisions" id="toc-design-decisions" class="nav-link" data-scroll-target="#design-decisions">Design Decisions</a></li>
  </ul></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code">Code</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#visualizations" id="toc-visualizations" class="nav-link" data-scroll-target="#visualizations">Visualizations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">




<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In this blog post, we will create three charts to investigate the accessibility of charging infrastructure for disadvantaged communities. Before we proceed to the data and code, let’s consider what makes this this topic important.</p>
<p>With a rapid transition to “green economy” EV charging infrastructure has come into the spotlight. Initiatives like California’s adoption of <a href="https://ww2.arb.ca.gov/our-work/programs/advanced-clean-cars-program/advanced-clean-cars-ii">“The Advanced Clean Cars II”</a> in 2022 mandating all new vehicle sales in California be zero-emissions vehicles (ZEV) by 2035, further turned attention to the availability of charging infrastructure. As states like Rhode Island, Washington, Virginia, Vermont, Oregon, New York, and Massachusetts adopted similar mandates and Connecticut, Colorado, Delaware, Maryland, New Jersey, New Mexico, Minnesota, and Nevada are expected to follow suit, the question in inclusivity of this transition becomes ever important. Will disadvantaged communities have equitable access to the benefits of the green economy, or will they be left behind? While high EV prices and limited availability remain primary obstacles, the lack of accessible charging infrastructure poses a challenge of its own. Insufficient charging infrastructure charging in these communities can discourage the households from adopting EVs. Furthermore, charging infrastructure offers multiple benefits to the communities where they are implemented, such as improved air quality, increased business opportunities, and higher real estate values, and etc. (refer to <a href="https://www.transportation.gov/rural/ev/toolkit/ev-benefits-and-challenges/community-benefits">DOE website</a>. Disadvantaged communities, in particular, stand to gain from these improvements.</p>
<section id="final-infographic" class="level3">
<h3 class="anchored" data-anchor-id="final-infographic">Final Infographic</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Infographic_Equitable_EV_Charging_Infrastructure.png" class="img-fluid figure-img" style="width:100.0%" alt="Infographic that addresses equity within EV charging network distribution and deployment in the United States"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-and-design-process" class="level2">
<h2 class="anchored" data-anchor-id="data-and-design-process">Data And Design process</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>I used the following data sets to address the question about <strong>equity within EV charging network distribution and deployment in the United States</strong>:<br>
</p>
<p><strong>Dataset 2</strong>. Climate and Economic Justice Screening Tool.&nbsp; Source: <a href="https://screeningtool.geoplatform.gov/en/#3/33.47/-97.5">CEJST</a><br>
</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learn about the dataset
</div>
</div>
<div class="callout-body-container callout-body">
<p>The dataset highlights disadvantaged census tracts across the United States, and the U.S. territories for the following categories: climate change, energy, health, housing, legacy pollution, transportation, water and wastewater, and workforce development. For this infographic I used transportation categories, as well as the community’s status as disadvantaged or not. Overview and metadata details:</p>
<pre><code>    a.  [Description of the dataset](https://static-data-screeningtool.geoplatform.gov/data-versions/1.0/data/score/downloadable/Using-the-CEJST-Spreadsheet-Tutorial.pdf).
    b.  [Technical documentation and methodology](https://screeningtool.geoplatform.gov/en/methodology).
    c.  [the GitHub repository](https://github.com/usds/justice40-tool/blob/main/DATASETS.md).</code></pre>
</div>
</div>
<p><strong>Climate and Economic Justice Tool data set</strong> variables used in modeling:<br>
* SF: State/Territory<br>
* CF: County Name<br>
* GEOID: Census Tract<br>
* TPF: Total population<br>
* TF_PFS: Traffic proximity and volume (percentile)<br>
* TP_ET: Greater than or equal to the 90th percentile for traffic proximity<br>
* SN_C: Definition N community, including adjacency index tracts<br>
</p>
<p><strong>Dataset 2</strong>. Alternative Fuels Data Center: Electric Vehicle Charging Station Locations.&nbsp; Source: <a href="https://developer.nrel.gov/docs/transportation/alt-fuel-stations-v1/all">NREL</a><br>
</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learn about the dataset
</div>
</div>
<div class="callout-body-container callout-body">
<p>The data set is accessible via NREL maintained API and provides a list of over 70 features related to alternative fuels alternative fuels stations. For this infographic I used a subset of attributes specific to electric vehicle charging stations.</p>
</div>
</div>
<p><strong>NREL API data set</strong> variables used in modeling:<br>
* id: EV charger ID<br>
* status_code: EV charger status (available, planned)<br>
* ev_dc_fast_num: DC fast charging port type<br>
* ev_level2_evse_num: Level 2 charging port type<br>
* longtitude and latitude: position of an EV charging station<br>
</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Types of charging ports
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Level 1 connector (<em>out of scope from the analysis</em>): standardized connector primarily for home use.<br>
The charge rate is 3-5 miles per hour.<br>
Applicable for trips up to 40 miles or less daily.<br>
</p></li>
<li><p>Level 2 charging port: standardized connector primarily for home or office use.<br>
The charge rate is 15-30 miles per hour.<br>
Applicable for trips 100+ miles daily.<br>
</p></li>
<li><p>DC fast charging port: three connector types (CCS, CHAdeMO, NACS) connected to dedicated high power stations.<br>
The charge rate is 150-400 miles per hour.<br>
Applicable for trips 300+ miles daily.<br>
</p></li>
</ul>
</div>
</div>
</section>
<section id="design-decisions" class="level3">
<h3 class="anchored" data-anchor-id="design-decisions">Design Decisions</h3>
<p>I designed the infographic to answer the question, <strong>“Is our EV charging infrastructure equitable?”</strong>. To do so, I created three different visuals each aimed at answering a leading question.</p>
<p><strong>Question 1</strong>: Which of the top 5 states have the most number of EV charging ports installed or in progress to date? This helped me to target my analysis on the states that have the most data to work with.<br>
</p>
<p><strong>Question 2</strong>: Among the top 5 states from Question 1, how do the ratios of EV charging ports to state population compare with those within disadvantaged communities in the 90th percentile of traffic proximity? These communities, being near major roads with heavy traffic, are ideal candidates for EV charging infrastructure deployment due to high demand.<br>
</p>
<p><strong>Question 3</strong>: In states where disadvantaged communities in the 90th percentile of traffic proximity have fewer EV charging ports per capita compared to the state average, can we see a noticeable bias in the distribution of EV charging stations on the map?</p>
<p>Next, I utilized the following design approach to visualize the questions above.</p>
<ol type="1">
<li><p>Graphic form.<br>
<strong>Question 1</strong>: I chose sunburst plot to display the number of EV chargers in each state. The choice was informed by a compact layout of sunburst plot and its ability to visualize distribution across multiple sections without overcrowding a figure. Sunburst plot also allows zooming into individual states to access statistics. <em>Note: the latter feature is available in the interactive mode only</em>. <strong>Question 2</strong>: A dumbbell plot was selected for its effectiveness in comparing two values measured in the same units. It offers a compact layout and ease of interpretation, which made it a preferred choice for visualizing the second question.<br>
<strong>Question 3</strong>: Finally, I used a choropleth style map to address the third question. This choice was driven by the need to visualize the distribution of EV charging within different types of census tracts across the state.<br>
</p></li>
<li><p>Text (e.g.&nbsp;titles, captions, annotations, axis labels, axis ticks, alt text). For the first and second figures I included the titles, while I relied on the legend to explain the choropleth map. I excluded the axis titles from all graphs it was not necessary to understand the content. This allowed me maintaining clean layouts.</p></li>
<li><p>Themes (i.e.&nbsp;all non-data plot elements). I used theme_bw and theme_void to keep the visuals clean by removing unnecessary elements such as axis from the choropleth maps or grid from the dumbell plot.</p></li>
<li><p>Colors. I opted for a pastel palette of green, pink and yellow.</p></li>
</ol>
<ul>
<li>A green color was used to symbolically display EV charger locations pointing towards “green” economy.<br>
</li>
<li>A pink color with a shade of brown was used to identify disadvantaged communities and carries a slight connotation of “lacking something”.</li>
<li>A light yellow was used as a background color as a complementary color that allows for a sufficient level of contrast between the different elements of visualizations.</li>
</ul>
<ol start="5" type="1">
<li>Typography: I used default fonts in my infographic to keep the layout simple and avoid distractions from the main questions. Where appropriate, I used a bold fontface and changed the size of the fonts for readability.</li>
<li>General design (e.g.&nbsp;group order, spacing, text orientation, data-ink ratio, creating a visual hierarchy, avoiding information overload). In my infographic I aimed to guide a viewer towards answering the main question “Is EV infrastructure in the United States equitable?”. For this I positioned the figures to transition from an overview (sunburst plot) to more focused details (choroplath maps).</li>
<li>Contextualizing your data.</li>
<li>Centering your primary message. The primary figure - a choroplath map - displays the distribution of EV chargers relative to disadvantaged communities. While it is the most critical element in answering the main question, I placed it below the other two figures to maintain a logical sequence in the narrative.</li>
<li>Considering accessibility (e.g.&nbsp;colorblind-friendly palettes / contrast, alt text). I attempted to use colors that are accessible for viewers who have color-blindness conditions. While for most cases of color-blindness I was able to achieve a sufficient level of contrast to view the figures, in few instances, such as monochromacy and protanipia, the contrast is lacking. I used an online color blindness <a href="https://www.color-blindness.com/coblis-color-blindness-simulator/">simulator</a> to verify the figures for color-blindness. To address these cases, I included an alt-text to all three visualizations.</li>
<li>Applying a DEI lens to your design (e.g.&nbsp;considering the people / communities / places represented in the data, framing of the questions). My infographic was focused on identifying a bias in deployment of EV charging infrastructure with respect to disadvantaged communities. I attempted to maintain an objective tone in both my visuals and text. Specifically, I used a federally sponsored data set “Climate and Economic Screening Tool” to identify disadvantaged communities.</li>
</ol>
</section>
</section>
<section id="code" class="level2">
<h2 class="anchored" data-anchor-id="code">Code</h2>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">## load packages</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggimage)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="do">## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="do">## import and process data</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="do">## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">file.path</span>(rootdir, <span class="st">"src"</span>, <span class="st">"prep.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualizations" class="level3">
<h3 class="anchored" data-anchor-id="visualizations">Visualizations</h3>
<section id="visualization-1-sunburst-chart" class="level4">
<h4 class="anchored" data-anchor-id="visualization-1-sunburst-chart">Visualization 1: Sunburst chart</h4>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Data Wrangling ---#</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define regions</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Midwest"</span>, <span class="dv">12</span>), <span class="fu">rep</span>(<span class="st">"Northeast"</span>, <span class="dv">12</span>), <span class="fu">rep</span>(<span class="st">"Southeast"</span>, <span class="dv">12</span>), <span class="fu">rep</span>(<span class="st">"Southwest"</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="st">"West"</span>, <span class="dv">11</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># define states</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Illinois"</span>, <span class="st">"Indiana"</span>, <span class="st">"Iowa"</span>, <span class="st">"Kansas"</span>, <span class="st">"Michigan"</span>, <span class="st">"Minnesota"</span>, <span class="st">"Missouri"</span>, <span class="st">"Nebraska"</span>, <span class="st">"North Dakota"</span>, <span class="st">"Ohio"</span>, <span class="st">"South Dakota"</span>, <span class="st">"Wisconsin"</span>), <span class="dv">1</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Connecticut"</span>, <span class="st">"Maryland"</span>, <span class="st">"Maine"</span>, <span class="st">"New York"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Vermont"</span>, <span class="st">"Delaware"</span>, <span class="st">"Massachusetts"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New Hampshire"</span>, <span class="st">"Rhode Island"</span>, <span class="st">"District of Columbia"</span>), <span class="dv">1</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Arkansas"</span>, <span class="st">"Louisiana"</span>, <span class="st">"Kentucky"</span>, <span class="st">"Tennessee"</span>, <span class="st">"Mississippi"</span>, <span class="st">"Alabama"</span>, <span class="st">"West Virginia"</span>, <span class="st">"Virginia"</span>, <span class="st">"North Carolina"</span>, <span class="st">"South Carolina"</span>, <span class="st">"Georgia"</span>, <span class="st">"Florida"</span>), <span class="dv">1</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Arizona"</span>, <span class="st">"New Mexico"</span>, <span class="st">"Texas"</span>, <span class="st">"Oklahoma"</span>), <span class="dv">1</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Alaska"</span>, <span class="st">"California"</span>, <span class="st">"Colorado"</span>, <span class="st">"Hawaii"</span>, <span class="st">"Idaho"</span>, <span class="st">"Montana"</span>, <span class="st">"Nevada"</span>, <span class="st">"Oregon"</span>, <span class="st">"Utah"</span>, <span class="st">"Washington"</span>, <span class="st">"Wyoming"</span>), <span class="dv">1</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># define ev_chargers deployed within each state</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>ev_ports <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3252</span>, <span class="dv">1489</span>, <span class="dv">815</span>, <span class="dv">1091</span>, <span class="dv">3210</span>, <span class="dv">1994</span>, <span class="dv">2471</span>, <span class="dv">550</span>, <span class="dv">204</span>, <span class="dv">3553</span>, <span class="dv">226</span>, <span class="dv">1393</span>, <span class="dv">2248</span>, <span class="dv">4660</span>, <span class="dv">1050</span>, <span class="dv">10613</span>, <span class="dv">4161</span>, <span class="dv">938</span>, <span class="dv">512</span>, <span class="dv">7038</span>, <span class="dv">3488</span>, <span class="dv">536</span>, <span class="dv">649</span>, <span class="dv">1053</span>, <span class="dv">807</span>, <span class="dv">650</span>, <span class="dv">783</span>, <span class="dv">1979</span>, <span class="dv">396</span>, <span class="dv">946</span>, <span class="dv">419</span>, <span class="dv">4125</span>, <span class="dv">3969</span>, <span class="dv">1351</span>, <span class="dv">4869</span>, <span class="dv">9560</span>, <span class="dv">3435</span>, <span class="dv">669</span>, <span class="dv">9539</span>, <span class="dv">1286</span>, <span class="dv">119</span>, <span class="dv">44034</span>, <span class="dv">5294</span>, <span class="dv">781</span>, <span class="dv">457</span>, <span class="dv">380</span>, <span class="dv">1886</span>, <span class="dv">2976</span>, <span class="dv">2217</span>, <span class="dv">5501</span>, <span class="dv">238</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># create the dataframe</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>ev_distribution_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">regions =</span> regions,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">states =</span> states,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">ev_ports =</span> ev_ports</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Hierarchy for sunburst plot ---# </span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># function to generate sunburst data hierarchy</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>as.sunburstDF <span class="ot">&lt;-</span> <span class="cf">function</span>(DF, <span class="at">value_column =</span> <span class="cn">NULL</span>, <span class="at">add_root =</span> <span class="cn">FALSE</span>){</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load data.table library to hanlde enhanced data.frame functionality</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(data.table)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  colNamesDF <span class="ot">&lt;-</span> <span class="fu">names</span>(DF)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.data.table</span>(DF)){</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    DT <span class="ot">&lt;-</span> <span class="fu">copy</span>(DF)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    DT <span class="ot">&lt;-</span> <span class="fu">data.table</span>(DF, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(add_root){</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    DT[, root <span class="sc">:</span><span class="er">=</span> <span class="st">"Total"</span>]  </span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  colNamesDT <span class="ot">&lt;-</span> <span class="fu">names</span>(DT)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  hierarchy_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(colNamesDT, value_column)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  DT[, (hierarchy_columns) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, as.factor), .SDcols <span class="ot">=</span> hierarchy_columns]</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(value_column) <span class="sc">&amp;&amp;</span> add_root){</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setcolorder</span>(DT, <span class="fu">c</span>(<span class="st">"root"</span>, colNamesDF))</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(value_column) <span class="sc">&amp;&amp;</span> <span class="sc">!</span>add_root) {</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setnames</span>(DT, value_column, <span class="st">"values"</span>, <span class="at">skip_absent=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setcolorder</span>(DT, <span class="fu">c</span>(<span class="fu">setdiff</span>(colNamesDF, value_column), <span class="st">"values"</span>))</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(value_column) <span class="sc">&amp;&amp;</span> add_root) {</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setnames</span>(DT, value_column, <span class="st">"values"</span>, <span class="at">skip_absent=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setcolorder</span>(DT, <span class="fu">c</span>(<span class="st">"root"</span>, <span class="fu">setdiff</span>(colNamesDF, value_column), <span class="st">"values"</span>))</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>  hierarchyList <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(hierarchy_columns)){</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    current_columns <span class="ot">&lt;-</span> colNamesDT[<span class="dv">1</span><span class="sc">:</span>i]</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(value_column)){</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>      currentDT <span class="ot">&lt;-</span> <span class="fu">unique</span>(DT[, ..current_columns][, <span class="at">values :=</span> .N, <span class="at">by =</span> current_columns], <span class="at">by =</span> current_columns)</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>      currentDT <span class="ot">&lt;-</span> DT[, <span class="fu">lapply</span>(.SD, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), by<span class="ot">=</span>current_columns, .SDcols <span class="ot">=</span> <span class="st">"values"</span>]</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setnames</span>(currentDT, <span class="fu">length</span>(current_columns), <span class="st">"labels"</span>)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    hierarchyList[[i]] <span class="ot">&lt;-</span> currentDT</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  hierarchyDT <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(hierarchyList, <span class="at">use.names =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>  parent_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(hierarchyDT), <span class="fu">c</span>(<span class="st">"labels"</span>, <span class="st">"values"</span>, value_column))</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>  hierarchyDT[, parents <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(.SD, <span class="dv">1</span>, <span class="cf">function</span>(x){<span class="fu">fifelse</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(x)), <span class="at">yes =</span> <span class="cn">NA_character_</span>, <span class="at">no =</span> <span class="fu">paste</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)], <span class="at">sep =</span> <span class="st">":"</span>, <span class="at">collapse =</span> <span class="st">" - "</span>))}), .SDcols <span class="ot">=</span> parent_columns]</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>  hierarchyDT[, ids <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(.SD, <span class="dv">1</span>, <span class="cf">function</span>(x){<span class="fu">paste</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)], <span class="at">collapse =</span> <span class="st">" - "</span>)}), .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"parents"</span>, <span class="st">"labels"</span>)]</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>  hierarchyDT[, <span class="fu">c</span>(parent_columns) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(hierarchyDT)</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>sunburstDF <span class="ot">&lt;-</span> <span class="fu">as.sunburstDF</span>(ev_distribution_df, <span class="at">value_column =</span> <span class="st">"ev_ports"</span>, <span class="at">add_root =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="co"># head(sunburstDF)</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SUnburst Plot --- #</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="co"># create labels for a sunburst plot</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>selected_states <span class="ot">&lt;-</span> ev_distribution_df <span class="sc">%&gt;%</span> </span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(states, ev_ports) <span class="sc">%&gt;%</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> ev_ports, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>selected_states <span class="ot">&lt;-</span> selected_states<span class="sc">$</span>states</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="co"># create text vector for selected states</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>text_selected <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sunburstDF<span class="sc">$</span>labels <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Midwest"</span>, <span class="st">"Northeast"</span>, <span class="st">"Southeast"</span>, <span class="st">"Southwest"</span>, <span class="st">"West"</span>, <span class="st">"Total"</span>), </span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>               <span class="fu">paste</span>(scales<span class="sc">::</span><span class="fu">comma</span>(sunburstDF<span class="sc">$</span>values), <span class="at">sep =</span> <span class="st">" "</span>),  <span class="co"># combine labels with their corresponding values for regions and totals</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(sunburstDF<span class="sc">$</span>labels <span class="sc">%in%</span> selected_states, </span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>                      scales<span class="sc">::</span><span class="fu">comma</span>(sunburstDF<span class="sc">$</span>values),  <span class="co"># include values for selected states</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>                      <span class="st">""</span>))  <span class="co"># set empty string for other states</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Create text vector for all states</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>text_all <span class="ot">&lt;-</span> <span class="fu">paste</span>(scales<span class="sc">::</span><span class="fu">comma</span>(sunburstDF<span class="sc">$</span>values), <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="co"># generate sunburst plot</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>sunburst_p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> sunburstDF,</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ids =</span> <span class="sc">~</span>ids, </span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="sc">~</span>labels, </span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>                      <span class="at">parents =</span> <span class="sc">~</span>parents,</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="sc">~</span>values,</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="st">'sunburst'</span>,</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>                      <span class="at">branchvalues =</span> <span class="st">'total'</span>,</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>                      <span class="at">textinfo =</span> <span class="st">'label+text'</span>,   <span class="co"># show label and text on static chart</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>                      <span class="at">hoverinfo =</span> <span class="st">'label+text'</span>,  <span class="co"># show label and text on hover</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>                      <span class="at">text =</span> text_selected,  <span class="co"># set initial text to display EV charging ports for top n states</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>                      <span class="at">hovertext =</span> text_all)  <span class="sc">%&gt;%</span>  <span class="co"># set hover text to display ports for all states</span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Which states have the highest number of EV charging ports </span><span class="sc">\n</span><span class="st"> planned and operational in the United States as of March 2024?"</span>,</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>         <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">t =</span> <span class="dv">70</span>, <span class="at">b =</span> <span class="dv">70</span>, <span class="at">l =</span> <span class="dv">5</span>, <span class="at">r =</span> <span class="dv">5</span>),</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>         <span class="at">sunburstcolorway =</span> <span class="fu">c</span>(<span class="st">"West"</span> <span class="ot">=</span> <span class="st">"#0c99c0"</span>,</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Northeast"</span> <span class="ot">=</span> <span class="st">"#E78173"</span>,</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Southeast"</span> <span class="ot">=</span> <span class="st">"#659b5e"</span>,</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Midwest"</span> <span class="ot">=</span> <span class="st">"#ffd23f"</span>,</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Southwest"</span> <span class="ot">=</span> <span class="st">"#d3b88c"</span>),</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>         <span class="at">paper_bgcolor =</span> <span class="st">"#FCF7ED"</span>,</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>         <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotations =</span> <span class="fu">list</span>(</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>           <span class="fu">list</span>(</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="fl">0.5</span>,</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.1</span>,  </span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>             <span class="at">xref =</span> <span class="st">"paper"</span>,</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>             <span class="at">yref =</span> <span class="st">"paper"</span>,</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>             <span class="at">text =</span> <span class="st">'Source: National Renewable Energy Laboratory (NREL)."Alternative Fuel Stations API Documentation."</span><span class="sc">\n</span><span class="st"> https://developer.nrel.gov/docs/transportation/alt-fuel-stations-v1'</span>,</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>             <span class="at">showarrow =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>             <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>         ))</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a><span class="co"># display plot</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>sunburst_p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ef1f713d2387f691cb7e" style="width:80%;height:80%;"></div>
<script type="application/json" data-for="htmlwidget-ef1f713d2387f691cb7e">{"x":{"visdat":{"9fe25310204":["function () ","plotlyVisDat"]},"cur_data":"9fe25310204","attrs":{"9fe25310204":{"ids":{},"labels":{},"parents":{},"values":{},"branchvalues":"total","textinfo":"label+text","hoverinfo":"label+text","text":["165,860","20,248","36,946","29,854","14,929","63,883","","","","","","","","","","","","","","","","10,613","","","","7,038","","","","","","","","","","","","","","","","9,560","","","9,539","","","44,034","","","","","","","","",""],"hovertext":["165,860","20,248","36,946","29,854","14,929","63,883","3,252","1,489","815","1,091","3,210","1,994","2,471","550","204","3,553","226","1,393","2,248","4,660","1,050","10,613","4,161","938","512","7,038","3,488","536","649","1,053","807","650","783","1,979","396","946","419","4,125","3,969","1,351","4,869","9,560","3,435","669","9,539","1,286","119","44,034","5,294","781","457","380","1,886","2,976","2,217","5,501","238"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"sunburst"}},"layout":{"margin":{"b":70,"l":5,"t":70,"r":5},"title":"Which states have the highest number of EV charging ports <br /> planned and operational in the United States as of March 2024?","sunburstcolorway":["#0c99c0","#E78173","#659b5e","#ffd23f","#d3b88c"],"paper_bgcolor":"#FCF7ED","font":{"size":14},"annotations":[{"x":0.5,"y":-0.10000000000000001,"xref":"paper","yref":"paper","text":"Source: National Renewable Energy Laboratory (NREL).\"Alternative Fuel Stations API Documentation.\"<br /> https://developer.nrel.gov/docs/transportation/alt-fuel-stations-v1","showarrow":false,"font":{"size":12}}],"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"ids":["Total","Total - Midwest","Total - Northeast","Total - Southeast","Total - Southwest","Total - West","Total - Midwest - Illinois","Total - Midwest - Indiana","Total - Midwest - Iowa","Total - Midwest - Kansas","Total - Midwest - Michigan","Total - Midwest - Minnesota","Total - Midwest - Missouri","Total - Midwest - Nebraska","Total - Midwest - North Dakota","Total - Midwest - Ohio","Total - Midwest - South Dakota","Total - Midwest - Wisconsin","Total - Northeast - Connecticut","Total - Northeast - Maryland","Total - Northeast - Maine","Total - Northeast - New York","Total - Northeast - Pennsylvania","Total - Northeast - Vermont","Total - Northeast - Delaware","Total - Northeast - Massachusetts","Total - Northeast - New Jersey","Total - Northeast - New Hampshire","Total - Northeast - Rhode Island","Total - Northeast - District of Columbia","Total - Southeast - Arkansas","Total - Southeast - Louisiana","Total - Southeast - Kentucky","Total - Southeast - Tennessee","Total - Southeast - Mississippi","Total - Southeast - Alabama","Total - Southeast - West Virginia","Total - Southeast - Virginia","Total - Southeast - North Carolina","Total - Southeast - South Carolina","Total - Southeast - Georgia","Total - Southeast - Florida","Total - Southwest - Arizona","Total - Southwest - New Mexico","Total - Southwest - Texas","Total - Southwest - Oklahoma","Total - West - Alaska","Total - West - California","Total - West - Colorado","Total - West - Hawaii","Total - West - Idaho","Total - West - Montana","Total - West - Nevada","Total - West - Oregon","Total - West - Utah","Total - West - Washington","Total - West - Wyoming"],"labels":["Total","Midwest","Northeast","Southeast","Southwest","West","Illinois","Indiana","Iowa","Kansas","Michigan","Minnesota","Missouri","Nebraska","North Dakota","Ohio","South Dakota","Wisconsin","Connecticut","Maryland","Maine","New York","Pennsylvania","Vermont","Delaware","Massachusetts","New Jersey","New Hampshire","Rhode Island","District of Columbia","Arkansas","Louisiana","Kentucky","Tennessee","Mississippi","Alabama","West Virginia","Virginia","North Carolina","South Carolina","Georgia","Florida","Arizona","New Mexico","Texas","Oklahoma","Alaska","California","Colorado","Hawaii","Idaho","Montana","Nevada","Oregon","Utah","Washington","Wyoming"],"parents":[null,"Total","Total","Total","Total","Total","Total - Midwest","Total - Midwest","Total - Midwest","Total - Midwest","Total - Midwest","Total - Midwest","Total - Midwest","Total - Midwest","Total - Midwest","Total - Midwest","Total - Midwest","Total - Midwest","Total - Northeast","Total - Northeast","Total - Northeast","Total - Northeast","Total - Northeast","Total - Northeast","Total - Northeast","Total - Northeast","Total - Northeast","Total - Northeast","Total - Northeast","Total - Northeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southeast","Total - Southwest","Total - Southwest","Total - Southwest","Total - Southwest","Total - West","Total - West","Total - West","Total - West","Total - West","Total - West","Total - West","Total - West","Total - West","Total - West","Total - West"],"values":[165860,20248,36946,29854,14929,63883,3252,1489,815,1091,3210,1994,2471,550,204,3553,226,1393,2248,4660,1050,10613,4161,938,512,7038,3488,536,649,1053,807,650,783,1979,396,946,419,4125,3969,1351,4869,9560,3435,669,9539,1286,119,44034,5294,781,457,380,1886,2976,2217,5501,238],"branchvalues":"total","textinfo":"label+text","hoverinfo":["label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text","label+text"],"text":["165,860","20,248","36,946","29,854","14,929","63,883","","","","","","","","","","","","","","","","10,613","","","","7,038","","","","","","","","","","","","","","","","9,560","","","9,539","","","44,034","","","","","","","","",""],"hovertext":["165,860","20,248","36,946","29,854","14,929","63,883","3,252","1,489","815","1,091","3,210","1,994","2,471","550","204","3,553","226","1,393","2,248","4,660","1,050","10,613","4,161","938","512","7,038","3,488","536","649","1,053","807","650","783","1,979","396","946","419","4,125","3,969","1,351","4,869","9,560","3,435","669","9,539","1,286","119","44,034","5,294","781","457","380","1,886","2,976","2,217","5,501","238"],"type":"sunburst","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(252,247,237,1)"}},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Total number of EV charging ports installed or in progress in the United States as of March 2024</p>
</div>
</div>
</section>
<section id="visualization-2-dumbbell-chart" class="level4">
<h4 class="anchored" data-anchor-id="visualization-2-dumbbell-chart">Visualization 2: dumbbell chart</h4>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Data Wrangling --- #</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- United States --- #</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>dac_us <span class="ot">&lt;-</span> us_ev_joined <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sf, geoid10, tpf, tf_pfs, n_trn, tp_et, n_trn_eomi, sn_c) <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">state_name =</span> sf,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">is_dac =</span> sn_c)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dataframe with disadvantaged communities in the US in proximity to traffic (&gt;= 90th percentile)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>dac_us_df <span class="ot">&lt;-</span> dac_us <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tpf)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tpf<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state_name <span class="sc">%in%</span> selected_states) <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name) <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dac_ev_count =</span> <span class="fu">sum</span>(tp_et <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> is_dac <span class="sc">==</span> <span class="dv">1</span>), <span class="co"># count all rows where DACs are in proximity to traffic</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">dac_tot_count =</span> <span class="fu">sum</span>(is_dac <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">dac_ev_tpf =</span> <span class="fu">sum</span>(tpf <span class="sc">*</span> (tp_et <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> is_dac <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">tpf_state =</span> <span class="fu">sum</span>(tpf)) <span class="sc">%&gt;%</span> <span class="co"># get a total population of DACs in proximity to traffic %&gt;% </span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># join us_fast_ports_per_state df to dac_us_df df</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>us_fast_ports <span class="ot">&lt;-</span> us_fast_ports_per_state <span class="sc">%&gt;%</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sf, geoid10, total_ports_per_tract) <span class="sc">%&gt;%</span> </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>ev_dac_us_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dac_us_df, us_fast_ports, <span class="at">by =</span> <span class="fu">join_by</span>(geoid10)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>sf) <span class="sc">%&gt;%</span> </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name) <span class="sc">%&gt;%</span> </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ev_ports_per_state_pop_pct =</span> <span class="fu">sum</span>(total_ports_per_tract)<span class="sc">/</span>tpf_state<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_ports_state =</span> <span class="fu">sum</span>(total_ports_per_tract),</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>         <span class="co"># calculate total ports as of % of total pop of DACs suitable for EV charging</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_ports_dac_pop_pct =</span> (<span class="fu">sum</span>(total_ports_per_tract <span class="sc">*</span> (tp_et <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> is_dac <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span>dac_ev_tpf)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_ports_dac =</span> <span class="fu">sum</span>(total_ports_per_tract <span class="sc">*</span> (tp_et <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> is_dac <span class="sc">==</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>ev_dac_us_chart <span class="ot">&lt;-</span> ev_dac_us_df <span class="sc">%&gt;%</span> </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_name, ev_ports_per_state_pop_pct, total_ports_dac_pop_pct) <span class="sc">%&gt;%</span> </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># add custom images to the dataframe</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>ev_state_pct_icon <span class="ot">&lt;-</span> <span class="st">"ev_green_icon.png"</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>ev_dac_pct_icon <span class="ot">&lt;-</span> <span class="st">"ev_orange_icon.png"</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>ev_dac_us_chart<span class="sc">$</span>ev_state_pct_icon <span class="ot">&lt;-</span> ev_state_pct_icon</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>ev_dac_us_chart<span class="sc">$</span>ev_dac_pct_icon <span class="ot">&lt;-</span> ev_dac_pct_icon</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Dumbbell chart --- #</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co"># create a graph with points as images </span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>dumbell_p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ev_dac_us_chart) <span class="sc">+</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> ev_ports_per_state_pop_pct,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> total_ports_dac_pop_pct,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="fu">fct_reorder</span>(state_name, ev_ports_per_state_pop_pct),</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> state_name)) <span class="sc">+</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_image</span>(<span class="fu">aes</span>(<span class="at">x =</span> ev_ports_per_state_pop_pct,</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> state_name, <span class="at">image =</span> ev_state_pct_icon), <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_image</span>(<span class="fu">aes</span>(<span class="at">x =</span> total_ports_dac_pop_pct,</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> state_name, <span class="at">image =</span> ev_dac_pct_icon), <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% of EV Charging Ports Per Capita"</span>,</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Comparing EV Charger Share: State Population vs. Disadvantaged Communities"</span>,</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Top 5 States by Number of Chargers Installed or Planned, as of March 2024"</span>,</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">'Source: National Renewable Energy Laboratory (NREL)."Alternative Fuel Stations API Documentation."</span><span class="sc">\n</span><span class="st"> https://developer.nrel.gov/docs/transportation/alt-fuel-stations-v1'</span>) <span class="sc">+</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>), </span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand=</span><span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">0</span>)) </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend and theme</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>dumbell_p <span class="ot">&lt;-</span> dumbell_p <span class="sc">+</span> </span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">xmin =</span> <span class="fl">0.105</span>, <span class="at">xmax=</span><span class="fl">0.16</span>,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>            <span class="at">ymin =</span> <span class="fl">0.7</span>, <span class="at">ymax =</span> <span class="fl">2.1</span>,</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">0.05</span>,</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha=</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_image</span>(<span class="at">x =</span> <span class="fl">0.109</span>, <span class="at">y =</span> <span class="fl">1.6</span>, <span class="at">image =</span> ev_state_pct_icon) <span class="sc">+</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_image</span>(<span class="at">x =</span> <span class="fl">0.109</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">image =</span> ev_dac_pct_icon) <span class="sc">+</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.109</span>, <span class="at">y =</span> <span class="dv">2</span>, </span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Share of EV charging ports"</span>, </span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.113</span>, <span class="at">y =</span> <span class="fl">1.6</span>, </span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"per state population"</span>, </span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.113</span>, <span class="at">y =</span> <span class="dv">1</span>, </span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"per state DAC population </span><span class="sc">\n</span><span class="st">in top 10% traffic proximity"</span>, </span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>        <span class="co">#axis.title.x = element_text(margin = margin(t = 15), size = 12, color = "white"),</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">15</span>), <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">l=</span><span class="dv">0</span>, <span class="at">t =</span> <span class="dv">15</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="st">"#FCF7ED"</span>, <span class="at">color =</span> <span class="st">"transparent"</span>),</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plot.background = element_rect("#1A5276", color = "transparent"), ##2ECC71</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"#FBFAF5"</span>)) </span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a><span class="co"># display dumbell plot</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>dumbell_p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/dumbell-plot-1.png" style="width:80.0%;height:80.0%" alt="A dumbell plot that compares the ratios of EV charging ports to state population with those within disadvantaged communities in the 90th percentile of traffic proximity" class="figure-img"></p>
<figcaption class="figure-caption">Comparing EV Charger Share: State Population vs.&nbsp;Disadvantaged Communities</figcaption>
</figure>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export dumbell plot</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">file =</span> (<span class="st">"assets/dumbell_p_bg.png"</span>), <span class="at">plot =</span> dumbell_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualization-choropleth-maps" class="level4">
<h4 class="anchored" data-anchor-id="visualization-choropleth-maps">Visualization: Choropleth maps</h4>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Data Wrangling --- #</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ny_state <span class="ot">&lt;-</span> <span class="fu">states</span>(<span class="at">class =</span> <span class="st">"sf"</span>, <span class="at">cb =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">state_name =</span> name) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(state_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"New York"</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create EV distribution SF object projected in 'EPSG':4269</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>ny_ev_sf <span class="ot">&lt;-</span> us_ev_sf <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"NY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(us_ev_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(ny_state)) <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_make_valid</span>()  <span class="co"># fix any invalid geometries after the transformation</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># crop ca_ev_sf df to the bounding box of New York state</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>ny_ev_sf <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(ny_ev_sf, ny_state)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sf dataframe with the locations of EV charging</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ports</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>ny_ev_sf <span class="ot">&lt;-</span> ny_ev_sf <span class="sc">%&gt;%</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(state, id, ev_level2_evse_num, ev_dc_fast_num) <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(state, id, ev_level2_evse_num, ev_dc_fast_num,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        geometry)) <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(ev_level2_evse_num) <span class="sc">&amp;</span> <span class="fu">is.na</span>(ev_dc_fast_num)))</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>ny_ev_loc <span class="ot">&lt;-</span> ny_ev_sf <span class="sc">%&gt;%</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.factor</span>(id)) <span class="sc">%&gt;%</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># create DACs distribution SF object projected in</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 'EPSG':4269</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>ny_dac_sf <span class="ot">&lt;-</span> us_ev_joined <span class="sc">%&gt;%</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">state_name =</span> sf, <span class="at">is_dac =</span> sn_c) <span class="sc">%&gt;%</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(state_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"New York"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(ny_state)) <span class="sc">%&gt;%</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_make_valid</span>()  <span class="co"># fix any invalid geometries after the transformation</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>ny_dac <span class="ot">&lt;-</span> ny_dac_sf <span class="sc">%&gt;%</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(state_name, is_dac, tp_et, tf_pfs) <span class="sc">%&gt;%</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dac_type =</span> <span class="fu">case_when</span>((is_dac <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> tf_pfs <span class="sc">&gt;=</span> <span class="fl">0.9</span> <span class="sc">~</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DAC &gt; 90th perc. Traffic Proximity"</span>), is_dac <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        tf_pfs <span class="sc">&lt;</span> <span class="fl">0.9</span> <span class="sc">~</span> <span class="st">"DAC"</span>, is_dac <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Non-DAC"</span>, <span class="at">.default =</span> <span class="st">"Uknown"</span>))</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Create Map of EV Chargers distribution in New York</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co"># State --- #</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co"># define inset map bbox</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>ny_state_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(ny_state)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co"># define bbox for the area with high concentration of DACs</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co"># in proximity to traffic</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>ny_dac_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="fl">74.2</span>, <span class="at">ymin =</span> <span class="fl">40.4</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">73.6</span>,</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> <span class="dv">41</span>), <span class="at">crs =</span> <span class="dv">4269</span>)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="co"># inset map</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>dac_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> ny_dac, <span class="fu">aes</span>(<span class="at">fill =</span> dac_type),</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"transparent"</span>) <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">" Disadvantaged Community"</span>,</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Non-DAC</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"#fff7d1"</span>, <span class="at">DAC =</span> <span class="st">"#ebb3a9"</span>, <span class="st">`</span><span class="at">DAC &gt; 90th perc. Traffic Proximity</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"#861657"</span>,</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">Uknown =</span> <span class="st">"#d9dcd6"</span>))</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>dac_map <span class="ot">&lt;-</span> dac_map <span class="sc">+</span> <span class="fu">geom_sf_text</span>(<span class="at">data =</span> ny_state, <span class="fu">aes</span>(<span class="at">label =</span> state_name,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">1.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">10.1</span>), <span class="at">size =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"grey30"</span>,</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"sans"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, <span class="at">check_overlap =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> ny_ev_loc, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"EV Charging Station"</span>),</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"#a7c957"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stat =</span> <span class="st">"sf_coordinates"</span>,</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="st">"#386641"</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">EV Charging Station</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"#386641"</span>)))) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>),</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>),</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span>), <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.19</span>, <span class="fl">0.188</span>), <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="st">"#FCF7ED"</span>, <span class="at">color =</span> <span class="st">"transparent"</span>),</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="st">"#FCF7ED"</span>, <span class="at">color =</span> <span class="st">"transparent"</span>)) <span class="sc">+</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> ny_dac_bbox<span class="sc">$</span>xmin, <span class="at">xmax =</span> ny_dac_bbox<span class="sc">$</span>xmax,</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>        <span class="at">ymin =</span> ny_dac_bbox<span class="sc">$</span>ymin, <span class="at">ymax =</span> ny_dac_bbox<span class="sc">$</span>ymax, <span class="at">fill =</span> <span class="st">"transparent"</span>,</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"#861657"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="co"># zoom in on the area with high DACs consentration</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>ny_ev_loc_zoom <span class="ot">&lt;-</span> ny_ev_loc <span class="sc">%&gt;%</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_crop</span>(ny_dac_bbox)</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>ny_dac_zoom <span class="ot">&lt;-</span> ny_dac <span class="sc">%&gt;%</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_crop</span>(ny_dac_bbox)</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>dac_zoom_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> ny_dac_zoom, <span class="fu">aes</span>(<span class="at">fill =</span> dac_type),</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey85"</span>) <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">" Disadvantaged Community"</span>,</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Non-DAC</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"#fff7d1"</span>, <span class="at">DAC =</span> <span class="st">"#ebb3a9"</span>, <span class="st">`</span><span class="at">DAC &gt; 90th perc. Traffic Proximity</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"#861657"</span>,</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">Uknown =</span> <span class="st">"#d9dcd6"</span>))</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>dac_zoom_map <span class="ot">&lt;-</span> dac_zoom_map <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> ny_ev_loc_zoom,</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"EV Charging Station"</span>), <span class="at">fill =</span> <span class="st">"#a7c957"</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"sf_coordinates"</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="st">"#386641"</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#FBFAF5"</span>, <span class="at">color =</span> <span class="st">"#861657"</span>,</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">linewidth =</span> <span class="dv">1</span>), <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#FCF7ED"</span>))</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>dac_map <span class="ot">&lt;-</span> dac_map <span class="sc">+</span> <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">81</span>, <span class="sc">-</span><span class="dv">65</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">39</span>,</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>    <span class="dv">46</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">"off"</span>)</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a><span class="co"># combine maps</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>choropleth_p <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span> <span class="fu">draw_plot</span>(dac_map, <span class="at">x =</span> <span class="sc">-</span><span class="fl">0.04</span>, <span class="at">y =</span> <span class="fl">0.01</span>,</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span>, <span class="at">height =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">draw_plot</span>(dac_zoom_map, <span class="at">x =</span> <span class="fl">0.455</span>,</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.19</span>, <span class="at">width =</span> <span class="fl">0.6</span>, <span class="at">height =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display choropleth maps</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>choropleth_p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/choropleth-display-1.png" style="width:100.0%;height:100.0%" alt="A main and inset choropleth maps plot that display where EV charging stations (DC fast chargers and level 2 chargers) and disadvantaged communities are located" class="figure-img"></p>
<figcaption class="figure-caption">A distribution of EV chargers in New York relative to disadvantaged communities as of March 2024</figcaption>
</figure>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export combined choropleth plot</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">file =</span> (<span class="st">"assets/choropleth_p.png"</span>), <span class="at">plot =</span> choropleth_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>