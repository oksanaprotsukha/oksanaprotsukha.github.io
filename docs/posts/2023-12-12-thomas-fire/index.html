<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oksana Protsukha">
<meta name="dcterms.date" content="2023-12-12">
<meta name="description" content="Data Analysis of Thomas Fire’s Impact on Air Quality Index (AQI) in Santa Barbara County (2017)">

<title>Oksana Protsukha - Impact of the Thomas Fire on AQI in Santa Barbara County, CA (2017)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(thomas_fire_banner.jpeg);
background-size: cover;
      }
</style>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Oksana Protsukha</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Impact of the Thomas Fire on AQI in Santa Barbara County, CA (2017)</h1>
                  <div>
        <div class="description">
          Data Analysis of Thomas Fire’s Impact on Air Quality Index (AQI) in Santa Barbara County (2017)
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">GeoSpatial</div>
                <div class="quarto-category">Python</div>
                <div class="quarto-category">Wild Fires</div>
                <div class="quarto-category">Air Quality</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://oksanaprotsukha.github.io/">Oksana Protsukha</a> </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://ucsb-meds.github.io">
              Master of Environmental Data Science Program
              </a>
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 12, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#impact-of-the-thomas-fire-on-aqi-in-santa-barbara-county-ca-2017" id="toc-impact-of-the-thomas-fire-on-aqi-in-santa-barbara-county-ca-2017" class="nav-link active" data-scroll-target="#impact-of-the-thomas-fire-on-aqi-in-santa-barbara-county-ca-2017">Impact of the Thomas Fire on AQI in Santa Barbara County, CA (2017)</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#purpose" id="toc-purpose" class="nav-link" data-scroll-target="#purpose">Purpose</a></li>
  <li><a href="#tools" id="toc-tools" class="nav-link" data-scroll-target="#tools">Tools</a></li>
  <li><a href="#highlights" id="toc-highlights" class="nav-link" data-scroll-target="#highlights">Highlights</a></li>
  <li><a href="#about-the-data" id="toc-about-the-data" class="nav-link" data-scroll-target="#about-the-data">About the data</a></li>
  <li><a href="#final-output" id="toc-final-output" class="nav-link" data-scroll-target="#final-output">Final Output</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis">Data Analysis</a>
  <ul class="collapse">
  <li><a href="#import-libraries" id="toc-import-libraries" class="nav-link" data-scroll-target="#import-libraries">Import Libraries</a></li>
  <li><a href="#visualize-aqi-in-santa-barbara-county-during-thomas-fire-2017" id="toc-visualize-aqi-in-santa-barbara-county-during-thomas-fire-2017" class="nav-link" data-scroll-target="#visualize-aqi-in-santa-barbara-county-during-thomas-fire-2017">Visualize AQI in Santa Barbara County during Thomas Fire (2017)</a>
  <ul class="collapse">
  <li><a href="#import-air-quality-data" id="toc-import-air-quality-data" class="nav-link" data-scroll-target="#import-air-quality-data">Import Air quality data </a><a id="section-5.1-import_aqi" class="nav-link" data-scroll-target="undefined"></a></li>
  <li><a href="#prepare-air-quality-data" id="toc-prepare-air-quality-data" class="nav-link" data-scroll-target="#prepare-air-quality-data">Prepare Air quality data</a></li>
  <li><a href="#join-dataframes" id="toc-join-dataframes" class="nav-link" data-scroll-target="#join-dataframes">Join dataframes</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">Data wrangling</a></li>
  <li><a href="#visualize-aqi-output" id="toc-visualize-aqi-output" class="nav-link" data-scroll-target="#visualize-aqi-output">Visualize AQI output </a><a id="section-7-plot_aqi" class="nav-link" data-scroll-target="undefined"></a></li>
  </ul></li>
  <li><a href="#create-a-false-color-image-to-visualize-the-thomas-fire-scar" id="toc-create-a-false-color-image-to-visualize-the-thomas-fire-scar" class="nav-link" data-scroll-target="#create-a-false-color-image-to-visualize-the-thomas-fire-scar">Create a false color image to visualize the Thomas Fire scar</a>
  <ul class="collapse">
  <li><a href="#import-geospatial-data" id="toc-import-geospatial-data" class="nav-link" data-scroll-target="#import-geospatial-data">Import geospatial data</a></li>
  <li><a href="#prepare-geospatial-data" id="toc-prepare-geospatial-data" class="nav-link" data-scroll-target="#prepare-geospatial-data">Prepare geospatial data </a><a id="section-8-prep_geodata" class="nav-link" data-scroll-target="undefined"></a></li>
  <li><a href="#create-a-false-color-image-of-thomas-fire-scar" id="toc-create-a-false-color-image-of-thomas-fire-scar" class="nav-link" data-scroll-target="#create-a-false-color-image-of-thomas-fire-scar">Create a false color image of Thomas Fire Scar</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">




<section id="impact-of-the-thomas-fire-on-aqi-in-santa-barbara-county-ca-2017" class="level1">
<h1>Impact of the Thomas Fire on AQI in Santa Barbara County, CA (2017)</h1>
<p>Author: Oksana Protsukha</p>
<p>Github repository: <a href="https://github.com/oksanaprotsukha/thomasfire_aqi_analysis">thomasfire_aqi_analysis</a></p>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In this notebook, we are going to analyze the impact of <a href="https://en.wikipedia.org/wiki/Thomas_Fire">Thomas Fire</a> on the air quality in Santa Barbara county in 2017. To do so, we will complete the following two tasks: <br> 1. Visualize the Air Quality Index (AQI) in Santa Barbara County for 2017 and 2018.<br> 2. Create a false color image to visualize the Thomas Fire scar.<br></p>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p><strong>Thomas Fire</strong> started on December 4, north of Santa Paula, CA, and was contained only on January 12, 2018. The fire, spread by the unusually strong and persistent <a href="http://people.atmos.ucla.edu/fovell/ASother/mm5/SantaAna/winds.html">Santa Ana winds</a>, destroyed 281,893 acres (440 sq mi; 114,078 ha) and threatened neighborhoods throughout Santa Barbara and Ventura counties. During this period, air quality significantly degraded to levels considered “very unhealthy” (201-300) by EPA standards. You can read about AIQ at <a href="https://www.airnow.gov/aqi/aqi-basics/">AirNow website</a>. <br></p>
<p><strong>False Color Image</strong> allows visualizing objects on the images that were generated via remote sensing using the wavelengths that fall outside the visual light spectrum: - Near-infrared (NIR) - Shortwave infrared (SWIR) - Midwave Infrared (MIR) - Infrared (IR) - Thermal or longwave infrared (TIR or LWIR) Assignment of these wavelegnths to different colors helps to highlight certain characteristics of an object that may not be visible in a true-color image.</p>
<p>I highly recommend NASA website to read more about the false color imagery: <a href="https://earthobservatory.nasa.gov/features/FalseColor">NASA Earth Observatory</a></p>
</section>
<section id="purpose" class="level3">
<h3 class="anchored" data-anchor-id="purpose">Purpose</h3>
<p>The primary purpose of the notebook is to demonstrate environmental data analysis methods using both vector and raster data.</p>
</section>
<section id="tools" class="level3">
<h3 class="anchored" data-anchor-id="tools">Tools</h3>
<ul>
<li>Python libraries
<ul>
<li><code>numpy</code></li>
<li><code>pandas</code></li>
<li><code>pyplot</code> and <code>patches</code> from <code>matplotlib</code></li>
<li><code>rioxarray</code></li>
<li><code>geopandas</code></li>
<li><code>xarray</code></li>
</ul></li>
<li>Jupyter Notebook</li>
<li>GitHub</li>
</ul>
</section>
<section id="highlights" class="level3">
<h3 class="anchored" data-anchor-id="highlights">Highlights</h3>
<ul>
<li>Data wrangling and exploration with <code>Pandas</code></li>
<li>Geospatial data wrangling with <code>GeoPandas</code> and <code>Rioxarray</code></li>
<li>Time series analysis</li>
<li>Merging tabular and vector data</li>
<li>Visualizing analysis results with a line plot</li>
<li>Creating and customizing a map with raster and vector data</li>
</ul>
</section>
<section id="about-the-data" class="level3">
<h3 class="anchored" data-anchor-id="about-the-data">About the data</h3>
<section id="dataset-1" class="level4">
<h4 class="anchored" data-anchor-id="dataset-1">DataSet 1</h4>
<p><a href="https://www.airnow.gov/aqi/aqi-basics/">Air Quality Index (AQI)</a> data from the <a href="https://www.epa.gov">US Environmental Protection Agency</a>[1] to visualize the impact on the AQI of the 2017 <a href="https://en.wikipedia.org/wiki/Thomas_Fire">Thomas Fire</a> in Santa Barbara County [2].</p>
</section>
<section id="dataset-2" class="level4">
<h4 class="anchored" data-anchor-id="dataset-2">DataSet 2</h4>
<p>A simplified collection of bands (red, green, blue, near-infrared and shortwave infrared) from the Landsat Collection 2 Level-2 atmosperically corrected surface reflectance data, collected by the Landsat 8 satellite [3]. <strong>Note</strong>: data should be used for visualization purposes only.</p>
<p>Information about Landsat bands from USGS:</p>
<ul>
<li><a href="https://www.usgs.gov/faqs/what-are-band-designations-landsat-satellites">What are the band designations for the Landsat satellites?</a><br></li>
<li><a href="https://www.usgs.gov/media/images/common-landsat-band-combinations">Common Landsat Band Combinations</a><br></li>
<li><a href="https://www.usgs.gov/faqs/how-do-i-use-a-scale-factor-landsat-level-2-science-products">How do I use a scale factor with Landsat Level-2 science products?</a><br></li>
</ul>
</section>
<section id="dataset-3" class="level4">
<h4 class="anchored" data-anchor-id="dataset-3">DataSet 3</h4>
<p>A prepared shapefile of fire perimeters in California during 2017. The <a href="https://gis.data.ca.gov/datasets/CALFIRE-Forestry::california-fire-perimeters-all-1/about">complete file can be accessed in the CA state geoportal</a>[4].</p>
<p><strong>Data for datasets 2 and 3 is available on Google Drive in the file</strong> <a href="https://drive.google.com/file/d/1lDBPBy9378Zcj1g9Huhe8F_WeP4LZ7CN/view?usp=sharing">thomasfire_aqi_analysis.zip</a>.</p>
</section>
</section>
<section id="final-output" class="level3">
<h3 class="anchored" data-anchor-id="final-output">Final Output</h3>
<p>The final outputs of the analysis include:</p>
<p>A <strong>Line Plot</strong> depicting the time series analysis of the Air Quality Index (AQI) in Santa Barbara for 2017 and 2018.<br> <img src="thomas_fire_aqi.png" width="800"></p>
<p>A <strong>Map</strong> with an overlay of the Thomas Fire scar on the Santa Barbara land cover.<br> <img src="thomas_fire_scar.png" width="800"></p>
</section>
</section>
</section>
<section id="data-analysis" class="level1">
<h1>Data Analysis</h1>
<section id="import-libraries" class="level3">
<h3 class="anchored" data-anchor-id="import-libraries">Import Libraries</h3>
<div class="cell" data-tags="[]" data-execution_count="59">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import libraries with standard abbreviations</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches <span class="co"># for creating legends</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rioxr</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prettytable <span class="im">import</span> PrettyTable <span class="co"># to format output as a table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualize-aqi-in-santa-barbara-county-during-thomas-fire-2017" class="level2">
<h2 class="anchored" data-anchor-id="visualize-aqi-in-santa-barbara-county-during-thomas-fire-2017">Visualize AQI in Santa Barbara County during Thomas Fire (2017)</h2>
<section id="import-air-quality-data" class="level3">
<h3 class="anchored" data-anchor-id="import-air-quality-data">Import Air quality data <a id="section-5.1-import_aqi"></a></h3>
<p>We are going to import AIQ data by county for 2017 and 2018.</p>
<div class="cell" data-tags="[]" data-execution_count="60">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import Daily AQI by County data from url: Dataset 1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read in 2017 Daily AQI by County</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>url_aqi_17 <span class="op">=</span> <span class="st">'https://aqs.epa.gov/aqsweb/airdata/daily_aqi_by_county_2017.zip'</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>aqi_17 <span class="op">=</span> pd.read_csv(url_aqi_17)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># read in 2018 Daily AQI by County</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>url_aqi_18 <span class="op">=</span> <span class="st">'https://aqs.epa.gov/aqsweb/airdata/daily_aqi_by_county_2018.zip'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>aqi_18 <span class="op">=</span> pd.read_csv(url_aqi_18)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="prepare-air-quality-data" class="level3">
<h3 class="anchored" data-anchor-id="prepare-air-quality-data">Prepare Air quality data</h3>
</section>
<section id="join-dataframes" class="level3">
<h3 class="anchored" data-anchor-id="join-dataframes">Join dataframes</h3>
<p>We currently have two separate dataframes for 2017 and 2018. However, in order to analyze AQI for the two years, we need to combine them by appending the rows from one dataframe on top of the other. We will use the pandas function <code>pd.concat()</code> to do so.</p>
<p><strong>Important</strong>: in order to combine the two dataframes their columns have to match.</p>
<div class="cell" data-tags="[]" data-execution_count="61">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether the columns between the two datasets match</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Do columns match?</span><span class="ch">\n</span><span class="ss"> </span><span class="sc">{</span>aqi_18<span class="sc">.</span>columns <span class="op">==</span> aqi_17<span class="sc">.</span>columns<span class="sc">}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether the column datatypes between the two datasets match</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Do datatypes of the columns match?</span><span class="ch">\n</span><span class="sc">{</span>aqi_18<span class="sc">.</span>dtypes <span class="op">==</span> aqi_17<span class="sc">.</span>dtypes<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Note</strong>: Since the column names and data types of the two datasets match exactly, we can combine them into a single dataframe. To ensure data quality, we will verify that the combined dataframe has a total number of rows equal to the sum of the records from the two separate datasets.</p>
<div class="cell" data-tags="[]" data-execution_count="62">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># combine two datasets aqi_17 and aqi_18 in a single one</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>aqi <span class="op">=</span> pd.concat([aqi_17, aqi_18])</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check the total count of rows matches the expected number</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Is the total number of rows in the combined dataframe as expected? </span><span class="sc">{</span><span class="bu">len</span>(aqi) <span class="op">==</span> (<span class="bu">len</span>(aqi_17)<span class="op">+</span><span class="bu">len</span>(aqi_18))<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># check the first 2 rows of the combined dataframe</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>aqi.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling">Data wrangling</h3>
<section id="filter-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="filter-dataframe">Filter dataframe</h4>
<p>For our analysis we need only AQI data from the Santa Barbara county. Let’s create a new dataframe<code>aqi_sb</code> filtered to <strong>Santa Barbara county</strong>.</p>
<p>Additionally, we will remove unecessary columns <code>state_name</code>, <code>county_name</code>, <code>state_code</code> and <code>county_code</code> from the new dataframe and update the column names to <code>snake_case</code> 🐍 to simplify data manipulation.</p>
<div class="cell" data-tags="[]" data-execution_count="63">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># update the column names case to snake_case</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>aqi.columns <span class="op">=</span> aqi.columns.<span class="bu">str</span>.lower().<span class="bu">str</span>.replace(<span class="st">' '</span>,<span class="st">'_'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># select the records where county_name = 'Santa Barbara' from the combined dataset aqi</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>aqi_sb <span class="op">=</span> aqi.loc[aqi.county_name <span class="op">==</span> <span class="st">'Santa Barbara'</span>].copy()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the state_name, county_name, state_code and county_code columns from aqi_sb</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>aqi_sb <span class="op">=</span> aqi_sb.drop(columns <span class="op">=</span> [<span class="st">'state_name'</span>, <span class="st">'county_name'</span>, <span class="st">'state_code'</span>, <span class="st">'county_code'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="set-date-column-as-the-index" class="level4">
<h4 class="anchored" data-anchor-id="set-date-column-as-the-index">Set date column as the index</h4>
<p>In our analysis, we will examine data over time. Having a date column in the <code>datetime</code> format, configured as an <code>index</code>, enables the use of built-in functions when working with dates.</p>
<div class="cell" data-execution_count="64">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data types of the columns</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(aqi_sb.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>date                         object
aqi                           int64
category                     object
defining_parameter           object
defining_site                object
number_of_sites_reporting     int64
dtype: object</code></pre>
</div>
</div>
<p>⚠️ Date column has type <code>object</code> rather than <code>datetime</code> as expected.</p>
<p>We will make the following changes to facilitate working with dates:</p>
<ul>
<li>Convert the date column of aqi_sb to a <code>datetime</code> object.</li>
<li>Set the date column as the <code>index</code> for aqi_sb dataframe.</li>
</ul>
<div class="cell" data-tags="[]" data-execution_count="65">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># update date column values of aqi_sb to datetype object</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>aqi_sb.date <span class="op">=</span> pd.to_datetime(aqi_sb.date)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># update the index of aqi_sb to be the date column</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>aqi_sb <span class="op">=</span> aqi_sb.set_index(<span class="st">'date'</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># check column date is updated</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(aqi_sb.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add-a-rolling-average-column" class="level4">
<h4 class="anchored" data-anchor-id="add-a-rolling-average-column">Add a rolling average column</h4>
<p>Our current dataframe contains daily values of AQI, which can create short-term fluctuations and noise in data. We’ll apply a 5-day rolling average to smooth out the data and improve the quality of the analysis. To achieve this we will create a new variable, five_day_average, using the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rolling.html">pandas method</a> <code>rolling</code>.</p>
<p><strong>Note</strong>: <code>rolling()</code> is a method for <code>pandas.series</code> that provides rolling window calculations. This is a lazy method (think groupby), we need to specify what we want to calculate over each window. It returns <code>pd.Series</code> as ouput.</p>
<p>Let’s update and view first few rows of the final dataframe. We will use this dataframe to visualize AQI in Santa Barbara county during 2017 and 2018.</p>
<div class="cell" data-tags="[]" data-execution_count="66">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate 5-day rolling average AQI</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the parameter '5D' indicates we want the window to be 5 days</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>aqi_sb[<span class="st">'five_day_average'</span>] <span class="op">=</span> aqi_sb.aqi.rolling(<span class="st">'5D'</span>).mean().<span class="bu">round</span>(<span class="dv">2</span>) </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># final dataframe for visualization</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>final_table <span class="op">=</span> PrettyTable()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add columns to the table</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>final_table.field_names <span class="op">=</span> aqi_sb.columns.tolist()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># subset_df = pd.concat([aqi_sb.head(3), aqi_sb.tail(3)])</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add rows to the table</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> aqi_sb.head(<span class="dv">5</span>).iterrows():</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    final_table.add_row(row.tolist())</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#PrettyTable(aqi_sb.head(2))</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(final_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>+-----+----------+--------------------+---------------+---------------------------+------------------+
| aqi | category | defining_parameter | defining_site | number_of_sites_reporting | five_day_average |
+-----+----------+--------------------+---------------+---------------------------+------------------+
|  39 |   Good   |       Ozone        |  06-083-4003  |             12            |       39.0       |
|  36 |   Good   |       Ozone        |  06-083-4003  |             11            |       37.5       |
|  71 | Moderate |        PM10        |  06-083-4003  |             12            |      48.67       |
|  34 |   Good   |       Ozone        |  06-083-4003  |             13            |       45.0       |
|  37 |   Good   |       Ozone        |  06-083-4003  |             12            |       43.4       |
+-----+----------+--------------------+---------------+---------------------------+------------------+</code></pre>
</div>
</div>
</section>
</section>
<section id="visualize-aqi-output" class="level3">
<h3 class="anchored" data-anchor-id="visualize-aqi-output">Visualize AQI output <a id="section-7-plot_aqi"></a></h3>
<p>In the next step, we will create a line plot with daily AQI and 5-day average AQI to visualize the impact of the Thomas Fire (December 2017) on air quality in Santa Barbara County.</p>
<div class="cell" data-tags="[]" data-execution_count="67">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot both the daily AQI and the 5-day average</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>aqi_sb.aqi.plot(ax<span class="op">=</span>ax,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                color <span class="op">=</span> <span class="st">'#fecc5c'</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>aqi_sb.five_day_average.plot(ax<span class="op">=</span>ax,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                color <span class="op">=</span> <span class="st">'#a50f15'</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># update axis</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Daily Average vs 5 day Average AQI in Santa Barbara (2017-2018)'</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Period'</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'AQI'</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>ax.legend([<span class="st">'AQI Daily Average'</span>, <span class="st">'AQI 5-day Average'</span>])</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># annotate the data source</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="st">"Data: AirData Website File Download Page.</span><span class="ch">\n</span><span class="st">https://aqs.epa.gov/aqsweb/airdata/download_files.html#AQI. Accessed 28 Nov. 2023"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            xy<span class="op">=</span>(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.15</span>), </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            fontsize<span class="op">=</span><span class="dv">7</span>, </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            xycoords<span class="op">=</span><span class="st">'axes fraction'</span>,  </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'#555555'</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            va<span class="op">=</span><span class="st">'top'</span>)  </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust the botton space of the figure</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(bottom<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>plt.show</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>&lt;function matplotlib.pyplot.show(close=None, block=None)&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>
<section id="interpretation" class="level4">
<h4 class="anchored" data-anchor-id="interpretation">Interpretation</h4>
<p>From the graph we can see a significant increase in both the daily average and 5-day rolling average in December 2017 compared to the rest of the year, which coincides with the Thomas Fire event. During this period, the AQI exceeded 200, falling into the <strong>very unhealthy</strong> category. According to AQI standards, at this level, the risk of health effects is increased for everyone.</p>
</section>
</section>
</section>
<section id="create-a-false-color-image-to-visualize-the-thomas-fire-scar" class="level2">
<h2 class="anchored" data-anchor-id="create-a-false-color-image-to-visualize-the-thomas-fire-scar">Create a false color image to visualize the Thomas Fire scar</h2>
<section id="import-geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="import-geospatial-data">Import geospatial data</h3>
<p>Data for the following two datasets is available on Google Drive in the file: <a href="https://drive.google.com/file/d/1lDBPBy9378Zcj1g9Huhe8F_WeP4LZ7CN/view?usp=sharing">thomasfire_aqi_analysis.zip</a>.</p>
<section id="import-landsat-geospatial-data-netcdf" class="level4">
<h4 class="anchored" data-anchor-id="import-landsat-geospatial-data-netcdf">Import Landsat geospatial data (netCDF)</h4>
<div class="cell" data-execution_count="68">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use rioxarray library to import netCDF file with geospatial features</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>fp_lsat <span class="op">=</span> <span class="st">'data/landsat8-2018-01-26-sb-simplified.nc'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>lsat <span class="op">=</span> rioxr.open_rasterio(fp_lsat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="import-california-fire-perimeter-shape-file" class="level4">
<h4 class="anchored" data-anchor-id="import-california-fire-perimeter-shape-file">Import California fire perimeter shape file</h4>
<div class="cell" data-execution_count="69">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use geopandas to import shape file with California fire perimeters </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>calfire <span class="op">=</span> gpd.read_file(os.path.join(os.getcwd(), <span class="st">'data'</span>, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">'California_Fire_Perimeters_2017'</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">'California_Fire_Perimeters_2017.shp'</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="prepare-geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="prepare-geospatial-data">Prepare geospatial data <a id="section-8-prep_geodata"></a></h3>
<p>First, let’s inspect geospatial datasets.</p>
<div class="cell" data-tags="[]" data-execution_count="70">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># explore shape file</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># view shape and data type</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'calfire dataset shape: </span><span class="sc">{</span>calfire<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'calfire dataset crs: </span><span class="sc">{</span>calfire<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># view the first two records of imported shape file data</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>calfire.head(<span class="dv">2</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize calfire data</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>calfire.plot(color <span class="op">=</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="create-a-new-dataframe-with-thomas-fire-scar-geometries" class="level4">
<h4 class="anchored" data-anchor-id="create-a-new-dataframe-with-thomas-fire-scar-geometries">Create a new dataframe with Thomas Fire scar geometries</h4>
<p>California fire perimeter dataset includes the list of all fires in California during 2017. For our analysis, we are interested only in Thomas fire that occured that year.</p>
<p>Therefore, we need to filter the dataset to the rows with Thomas fire.</p>
<p><strong>Note</strong>: We only have one record with <code>fire_name = "THOMAS"</code> in the dataframe. This is the record that contains the geometries of the Thomas Fire scar.</p>
<div class="cell" data-tags="[]" data-execution_count="71">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update the column names case to snake_case</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>calfire.columns <span class="op">=</span> calfire.columns.<span class="bu">str</span>.lower().<span class="bu">str</span>.replace(<span class="st">' '</span>,<span class="st">'_'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># find the value that corresponds to Thomas fire</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>calfire[calfire.fire_name.<span class="bu">str</span>.contains(<span class="st">'Thomas'</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'fire_name'</span>].unique()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new dataframe with Thomas fire details</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>tf <span class="op">=</span> calfire[calfire.fire_name <span class="op">==</span> <span class="st">'THOMAS'</span>]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only required fields</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>tf <span class="op">=</span> tf.loc[:, [<span class="st">'fire_name'</span>, <span class="st">'gis_acres'</span>, <span class="st">'shape_leng'</span>,<span class="st">'shape_area'</span>,<span class="st">'geometry'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="reproject-crs" class="level4">
<h4 class="anchored" data-anchor-id="reproject-crs">Reproject CRS</h4>
<p>⚠️ Important:</p>
<ol type="1">
<li><p>In order to overlay the Thomas Fire perimeter on the Santa Barbara County land cover, we need to ensure that the CRSs of the two datasets are the same. To achieve this, we will reproject the CRS of the tf dataset into the CRS of the lsat dataset.</p></li>
<li><p>The lsat dataset includes an additional dimension, the band, which makes it a 3-dimensional object. We are going to convert it into a 2-dimensional dataset by dropping the band dimension.</p></li>
</ol>
<div class="cell" data-execution_count="72">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check that crs of the shape file and netCDF match</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>calfire.crs <span class="op">==</span> lsat.rio.crs</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># update CRS of the shape file to lsat CRS</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>tf <span class="op">=</span> tf.to_crs(crs <span class="op">=</span> lsat.rio.crs)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'CRS of the lsat and tf datasets match: </span><span class="sc">{</span>tf<span class="sc">.</span>crs <span class="op">==</span> lsat<span class="sc">.</span>rio<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># drop an extra dimension "band" from lsat dataset</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>lsat <span class="op">=</span> lsat.squeeze().drop(<span class="st">'band'</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># check that band dimension has been dropped</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'After squeeze:</span><span class="ch">\n</span><span class="ss">dimensions </span><span class="sc">{</span>lsat<span class="sc">.</span>dims<span class="sc">}</span><span class="ch">\n</span><span class="ss">coords: </span><span class="sc">{</span>lsat<span class="sc">.</span>coords<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="create-a-false-color-image-of-thomas-fire-scar" class="level3">
<h3 class="anchored" data-anchor-id="create-a-false-color-image-of-thomas-fire-scar">Create a false color image of Thomas Fire Scar</h3>
<p>In the final step we will create a map showing the shortwave infrared/nir/ ed false color image together with the Thomas fire perimeter.</p>
<div class="cell" data-tags="[]" data-execution_count="73">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove axis</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot Thomas fire perimeter</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>tf.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'none'</span>, edgecolor <span class="op">=</span> <span class="st">'#483C32'</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>tf_patch <span class="op">=</span> mpatches.Patch(facecolor <span class="op">=</span> <span class="st">'none'</span>, </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                          edgecolor<span class="op">=</span><span class="st">'#483C32'</span>, </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                          label<span class="op">=</span><span class="st">'Thomas Fire Perimeter (2017)'</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot raster image of Santa Barbara area</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>lsat[[<span class="st">'swir22'</span>, <span class="st">'nir08'</span>, <span class="st">'red'</span>]].to_array().plot.imshow(ax<span class="op">=</span>ax, robust <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>[tf_patch], frameon<span class="op">=</span><span class="va">True</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Thomas Fire (Santa Barbara, 2017)'</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># annotate the data source</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="st">"Data: Microsoft Planetary Computer.https://planetarycomputer.microsoft.com/dataset/landsat-c2-l2. Accessed 28 Nov. 2023.</span><span class="ch">\n</span><span class="st">California Fire Perimeters (All).https://gis.data.ca.gov/datasets/CALFIRE-Forestry::california-fire-perimeters-all-1/about. Accessed 28 Nov. 2023."</span>,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>            xy<span class="op">=</span>(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.15</span>),  <span class="co"># Move the annotation lower to leave space for the x-axis title</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>            fontsize<span class="op">=</span><span class="dv">7</span>, </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>            xycoords<span class="op">=</span><span class="st">'axes fraction'</span>,  </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'#555555'</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">'center'</span>)  </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust the botton space of the figure</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(bottom<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># display map</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Citations</p>
<p><sup>[1]</sup> AirData Website File Download Page. <a href="https://aqs.epa.gov/aqsweb/airdata/download_files.html#AQI">link</a>. Accessed 28 Nov.&nbsp;2023.</p>
<p><sup>[2]</sup> “Thomas Fire.” Wikipedia, 9 Nov.&nbsp;2023. Wikipedia, <a href="https://en.wikipedia.org/w/index.php?title=Thomas_Fire&amp;oldid=1184323284">link</a>.</p>
<p><sup>[3]</sup> Microsoft Planetary Computer. <a href="https://planetarycomputer.microsoft.com/dataset/landsat-c2-l2">link</a>. Accessed 28 Nov.&nbsp;2023.</p>
<p><sup>[4]</sup> California Fire Perimeters (All). <a href="https://gis.data.ca.gov/datasets/CALFIRE-Forestry::california-fire-perimeters-all-1/about">link</a>. Accessed 28 Nov.&nbsp;2023.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
